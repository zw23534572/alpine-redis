# 部署指南

rancher redisHA 模板有一些问题。
需要搞的有一下：

redis-trib 只支持 ip。 所以，需要在 redis 全启动后， 再用 redis-trib 初始化集群

redis volume 是 /data 目录，所以，只需要 挂载目录的时候，rancher-nfs/???:/data 即可


# 修改为继承单机redis

## 基于缓存实现分布式锁
相比较于基于数据库实现分布式锁的方案来说，基于缓存来实现在性能方面会表现的更好一点。而且很多缓存是可以集群部署的，可以解决单点问题。

目前有很多成熟的缓存产品，包括Redis，memcached。

#### 遇到的问题
- 这把锁没有失效时间，一旦解锁操作失败，就会导致锁记录一直在tair中，其他线程无法再获得到锁。
- 这把锁只能是非阻塞的，无论成功还是失败都直接返回。
- 这把锁是非重入的，一个线程获得锁之后，在释放锁之前，无法再次获得该锁，因为使用到的key在tair中已经存在。无法再执行put操作。

#### 解决方案
- 没有失效时间？tair的put方法支持传入失效时间，到达时间之后数据会自动删除。
- 非阻塞？while重复执行。
- 非可重入？在一个线程获取到锁之后，把当前主机信息和线程信息保存起来，下次再获取之前先检查自己是不是当前锁的拥有者。